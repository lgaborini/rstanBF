<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction and usage • rstanBF</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction and usage">
<meta property="og:description" content="rstanBF">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rstanBF</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/dirichletdirichlet-model.html">Dirichlet-Dirichlet model, and tests</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Introduction and usage</a>
    </li>
    <li>
      <a href="../articles/normalnormal-model.html">Normal-Normal model</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="introduction_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction and usage</h1>
                        <h4 data-toc-skip class="author">LG</h4>
            
            <h4 data-toc-skip class="date">2021-03-09</h4>
      
      
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    

<p>This vignette introduces the package.</p>
<div id="data-generation" class="section level2">
<h2 class="hasAnchor">
<a href="#data-generation" class="anchor"></a>Data generation</h2>
<p>Let’s first create some data.<br>
We will use the package <code>rsamplestudy</code> to generate a population and to extract the reference/questioned samples.</p>
<p>Here, we will be generating data from a “Dirichlet-Dirichlet” model.<br>
Note that this has nothing to do with the models implemented in this package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">rstanBF</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: Rcpp</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lgaborini/rsamplestudy" class="external-link">rsamplestudy</a></span><span class="op">)</span>


<span class="co"># set.seed(123)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">5</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">p</span><span class="op">)</span>

<span class="va">list_pop</span> <span class="op">&lt;-</span> <span class="fu">rsamplestudy</span><span class="fu">::</span><span class="fu"><a href="https://lgaborini.github.io/rsamplestudy/reference/fun_rdirichlet_population.html" class="external-link">fun_rdirichlet_population</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">m</span>, <span class="va">p</span>, alpha <span class="op">=</span> <span class="va">alpha</span><span class="op">)</span>
<span class="va">list_pop</span>
<span class="co">#&gt; $alpha</span>
<span class="co">#&gt; # A tibble: 1 x 5</span>
<span class="co">#&gt;   `alpha[1]` `alpha[2]` `alpha[3]` `alpha[4]` `alpha[5]`</span>
<span class="co">#&gt;        &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1          5          5          5          5          5</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $df_sources</span>
<span class="co">#&gt; # A tibble: 10 x 6</span>
<span class="co">#&gt;    source `theta[1]` `theta[2]` `theta[3]` `theta[4]` `theta[5]`</span>
<span class="co">#&gt;     &lt;int&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1      1     0.0983      0.177     0.345      0.220      0.160 </span>
<span class="co">#&gt;  2      2     0.268       0.162     0.161      0.144      0.265 </span>
<span class="co">#&gt;  3      3     0.217       0.430     0.0849     0.0818     0.187 </span>
<span class="co">#&gt;  4      4     0.191       0.245     0.205      0.239      0.121 </span>
<span class="co">#&gt;  5      5     0.139       0.268     0.361      0.114      0.118 </span>
<span class="co">#&gt;  6      6     0.292       0.186     0.114      0.263      0.145 </span>
<span class="co">#&gt;  7      7     0.237       0.189     0.242      0.144      0.189 </span>
<span class="co">#&gt;  8      8     0.142       0.104     0.173      0.368      0.213 </span>
<span class="co">#&gt;  9      9     0.174       0.309     0.116      0.131      0.270 </span>
<span class="co">#&gt; 10     10     0.321       0.216     0.141      0.261      0.0614</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $df_pop</span>
<span class="co">#&gt; # A tibble: 1,000 x 6</span>
<span class="co">#&gt;    source   `x[1]`   `x[2]`  `x[3]`    `x[4]`       `x[5]`</span>
<span class="co">#&gt;     &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;</span>
<span class="co">#&gt;  1      1 6.18e- 5 0.647    0.353   0.000599  0.0000000424</span>
<span class="co">#&gt;  2      1 1.18e- 1 0.283    0.536   0.00247   0.0609      </span>
<span class="co">#&gt;  3      1 1.60e- 2 0.00869  0.271   0.691     0.0135      </span>
<span class="co">#&gt;  4      1 3.33e- 3 0.101    0.804   0.0770    0.0138      </span>
<span class="co">#&gt;  5      1 8.85e- 1 0.00749  0.00144 0.103     0.00287     </span>
<span class="co">#&gt;  6      1 2.68e-12 0.00144  0.367   0.281     0.351       </span>
<span class="co">#&gt;  7      1 1.26e- 9 0.119    0.731   0.0000486 0.150       </span>
<span class="co">#&gt;  8      1 4.03e- 1 0.000178 0.535   0.0168    0.0450      </span>
<span class="co">#&gt;  9      1 2.90e- 4 0.587    0.00140 0.364     0.0470      </span>
<span class="co">#&gt; 10      1 4.70e- 2 0.323    0.00963 0.620     0.000562    </span>
<span class="co">#&gt; # … with 990 more rows</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $names_var</span>
<span class="co">#&gt; [1] "x[1]" "x[2]" "x[3]" "x[4]" "x[5]"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $names_source</span>
<span class="co">#&gt; [1] "theta[1]" "theta[2]" "theta[3]" "theta[4]" "theta[5]"</span></code></pre></div>
<div id="sampling-generation" class="section level3">
<h3 class="hasAnchor">
<a href="#sampling-generation" class="anchor"></a>Sampling generation</h3>
<p>The package compares two sets of <em>items</em> (reference and questioned) and evaluates their support to a pair of hypotheses.</p>
<ul>
<li>
<span class="math inline">\(H_1\)</span>: the questioned items come from the reference source</li>
<li>
<span class="math inline">\(H_2\)</span>: the questioned items come from other different sources</li>
</ul>
<p>We simulate a situation using the function <code>make_dataset_splits</code> from the package <code>rsamplestudy</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">k_ref</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">k_quest</span> <span class="op">&lt;-</span> <span class="fl">10</span>

<span class="co"># We sample from all sources</span>
<span class="va">sources</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">list_pop</span><span class="op">$</span><span class="va">df_pop</span><span class="op">$</span><span class="va">source</span><span class="op">)</span>
<span class="va">list_samples_diff</span> <span class="op">&lt;-</span> <span class="va">list_pop</span><span class="op">$</span><span class="va">df_pop</span> <span class="op">%&gt;%</span> <span class="fu">rsamplestudy</span><span class="fu">::</span><span class="fu"><a href="https://lgaborini.github.io/rsamplestudy/reference/make_dataset_splits.html" class="external-link">make_dataset_splits</a></span><span class="op">(</span><span class="va">k_ref</span>, <span class="va">k_quest</span><span class="op">)</span>

<span class="va">source_same</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">list_samples_diff</span><span class="op">$</span><span class="va">df_reference</span><span class="op">$</span><span class="va">source</span><span class="op">)</span>
<span class="va">list_samples_same</span> <span class="op">&lt;-</span> <span class="va">list_pop</span><span class="op">$</span><span class="va">df_pop</span> <span class="op">%&gt;%</span> <span class="fu">rsamplestudy</span><span class="fu">::</span><span class="fu"><a href="https://lgaborini.github.io/rsamplestudy/reference/make_dataset_splits.html" class="external-link">make_dataset_splits</a></span><span class="op">(</span><span class="va">k_ref</span>, <span class="va">k_quest</span>, source_ref <span class="op">=</span> <span class="va">source_same</span>, source_quest <span class="op">=</span> <span class="va">source_same</span><span class="op">)</span>

<span class="va">list_samples_H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>H1 <span class="op">=</span> <span class="va">list_samples_same</span>, H2 <span class="op">=</span> <span class="va">list_samples_diff</span><span class="op">)</span></code></pre></div>
<p>These need to be converted to a friendly format (matrices and lists) from <code>rsamplestudy</code> output:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">list_data_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stanBF_prepare_rsamplestudy_data.html">stanBF_prepare_rsamplestudy_data</a></span><span class="op">(</span><span class="va">list_pop</span>, <span class="va">list_samples_diff</span><span class="op">)</span>
<span class="va">list_data_same</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stanBF_prepare_rsamplestudy_data.html">stanBF_prepare_rsamplestudy_data</a></span><span class="op">(</span><span class="va">list_pop</span>, <span class="va">list_samples_same</span><span class="op">)</span></code></pre></div>
<p>We see that each list contains the full set of observations, the set of indexes to reference items, and the set of indexes to the questioned items:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">list_data_diff</span><span class="op">)</span>
<span class="co">#&gt; List of 3</span>
<span class="co">#&gt;  $ mtx      : num [1:1000, 1:5] 6.18e-05 1.18e-01 1.60e-02 3.33e-03 8.85e-01 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : NULL</span>
<span class="co">#&gt;   .. ..$ : chr [1:5] "x[1]" "x[2]" "x[3]" "x[4]" ...</span>
<span class="co">#&gt;  $ idx.ref  : int [1:10] 406 408 413 420 432 434 436 475 490 491</span>
<span class="co">#&gt;  $ idx.quest: int [1:10] 123 148 202 218 546 589 617 820 822 984</span></code></pre></div>
<p>From now on, we are ready to use the <code>rstanBF</code> package.</p>
</div>
</div>
<div id="data-model" class="section level2">
<h2 class="hasAnchor">
<a href="#data-model" class="anchor"></a>Data model</h2>
<p>The package supports several models, identified by their short names:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/available_models.html">available_models</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "DirDir"      "DirFNorm"    "DirDirGamma" "NormNorm"</span></code></pre></div>
<p>More details are also available in data frame form:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/available_models.html">available_models</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">df_models</span>
<span class="co">#&gt; # A tibble: 4 x 5</span>
<span class="co">#&gt;   short_name  long_name                S3_class    hyperpriors source_files</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;                    &lt;chr&gt;       &lt;list&gt;      &lt;list&gt;      </span>
<span class="co">#&gt; 1 DirDir      Dirichlet-Dirichlet      stanBF_turn &lt;chr [1]&gt;   &lt;chr [2]&gt;   </span>
<span class="co">#&gt; 2 DirFNorm    Dirichlet-FoldedNormal   stanBF_turn &lt;chr [2]&gt;   &lt;chr [2]&gt;   </span>
<span class="co">#&gt; 3 DirDirGamma Dirichlet-DirichletGamma stanBF_turn &lt;chr [3]&gt;   &lt;chr [2]&gt;   </span>
<span class="co">#&gt; 4 NormNorm    Normal-Normal            NULL        &lt;chr [4]&gt;   &lt;chr [2]&gt;</span></code></pre></div>
<p>and also in text form:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/available_models.html">available_models</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">TRUE</span>, do_print <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Model: "DirDir"</span>
<span class="co">#&gt; Long name: "Dirichlet-Dirichlet"</span>
<span class="co">#&gt; Hyperparameters: alpha</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model: "DirFNorm"</span>
<span class="co">#&gt; Long name: "Dirichlet-FoldedNormal"</span>
<span class="co">#&gt; Hyperparameters: c("mu", "sigma")</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model: "DirDirGamma"</span>
<span class="co">#&gt; Long name: "Dirichlet-DirichletGamma"</span>
<span class="co">#&gt; Hyperparameters: c("alpha", "alpha_0", "beta_0")</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model: "NormNorm"</span>
<span class="co">#&gt; Long name: "Normal-Normal"</span>
<span class="co">#&gt; Hyperparameters: c("mu_mu0", "mu_sigma0", "sigma_mu0", "sigma_sigma0")</span></code></pre></div>
</div>
<div id="hyperparameter-elicitation" class="section level2">
<h2 class="hasAnchor">
<a href="#hyperparameter-elicitation" class="anchor"></a>Hyperparameter elicitation</h2>
<p>We choose the Dirichlet-Dirichlet model.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="st">'DirDir'</span></code></pre></div>
<p>The only hyperparameter which must be provided is <span class="math inline">\(\alpha\)</span>, the Dirichlet parameter at the hyperprior level.</p>
<p>It is known since the data has been generated: let’s use it, for now.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">list_hyperpriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">list_pop</span><span class="op">$</span><span class="va">alpha</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="using-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#using-functions" class="anchor"></a>Using functions</h3>
<p>If one wants to elicit a value for the hyperparameter(s) required by the model, the package supplies the function <code>stanBF_elicit_hyperpriors</code>.<br>
See the documentation for details:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/stanBF_elicit_hyperpriors.html">stanBF_elicit_hyperpriors</a></span><span class="op">(</span><span class="va">list_samples_same</span><span class="op">$</span><span class="va">df_background</span>, <span class="va">model</span>, mode_hyperparameter <span class="op">=</span> <span class="st">'ML'</span>, mode_ML <span class="op">=</span> <span class="st">'naive'</span><span class="op">)</span>
<span class="co">#&gt; $alpha</span>
<span class="co">#&gt; [1] 5.624985 6.520285 5.243898 5.436044 4.805356</span>
<span class="fu"><a href="../reference/stanBF_elicit_hyperpriors.html">stanBF_elicit_hyperpriors</a></span><span class="op">(</span><span class="va">list_samples_same</span><span class="op">$</span><span class="va">df_background</span>, <span class="va">model</span>, mode_hyperparameter <span class="op">=</span> <span class="st">'ML'</span>, mode_ML <span class="op">=</span> <span class="st">'ML'</span><span class="op">)</span>
<span class="co">#&gt; $alpha</span>
<span class="co">#&gt; [1] 8.887560 9.972066 8.114447 8.547322 7.743088</span></code></pre></div>
<p>Compare the estimate with the generating value:</p>
<p><span class="math inline">\(\alpha = \left( 5,5,5,5,5 \right)\)</span></p>
</div>
</div>
<div id="sampling" class="section level2">
<h2 class="hasAnchor">
<a href="#sampling" class="anchor"></a>Sampling</h2>
<p>We need to set up the HMC parameters, first:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n.iter</span> <span class="op">&lt;-</span> <span class="fl">2000</span>
<span class="va">n.burnin</span> <span class="op">&lt;-</span> <span class="fl">200</span>
<span class="co"># n.iter &lt;- 10000</span>
<span class="co"># n.burnin &lt;- 1000</span>

<span class="va">n.chains</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">n.cores</span> <span class="op">&lt;-</span> <span class="fl">2</span></code></pre></div>
<p>Now we are ready! Let’s sample:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stanBF_obj_same</span> <span class="op">&lt;-</span> <span class="fu">rstanBF</span><span class="fu">::</span><span class="fu"><a href="../reference/compute_BF_Stan.html">compute_BF_Stan</a></span><span class="op">(</span><span class="va">list_data_same</span>, <span class="va">model</span>, <span class="va">list_hyperpriors</span>, data_other <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">n.iter</span>, <span class="va">n.burnin</span>, <span class="va">n.chains</span>, <span class="va">n.cores</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">stanBF_obj_diff</span> <span class="op">&lt;-</span> <span class="fu">rstanBF</span><span class="fu">::</span><span class="fu"><a href="../reference/compute_BF_Stan.html">compute_BF_Stan</a></span><span class="op">(</span><span class="va">list_data_diff</span>, <span class="va">model</span>, <span class="va">list_hyperpriors</span>, data_other <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">n.iter</span>, <span class="va">n.burnin</span>, <span class="va">n.chains</span>, <span class="va">n.cores</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stanBF_obj_same</span>
<span class="co">#&gt; stanBF object containing posterior samples from H1, H2.</span>
<span class="co">#&gt; Model: Dirichlet-Dirichlet </span>
<span class="co">#&gt; Obtained BF: 19.85863 </span>
<span class="co">#&gt; Ran with 2 chains, 2000 HMC iterations.</span>
<span class="va">stanBF_obj_diff</span>
<span class="co">#&gt; stanBF object containing posterior samples from H1, H2.</span>
<span class="co">#&gt; Model: Dirichlet-Dirichlet </span>
<span class="co">#&gt; Obtained BF: 0.007149727 </span>
<span class="co">#&gt; Ran with 2 chains, 2000 HMC iterations.</span></code></pre></div>
</div>
<div id="bayes-factor" class="section level2">
<h2 class="hasAnchor">
<a href="#bayes-factor" class="anchor"></a>Bayes Factor</h2>
<p>The objects contain the Bayes Factors:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stanBF_obj_same</span><span class="op">$</span><span class="va">BF</span>
<span class="co">#&gt; [1] 19.85863</span>
<span class="va">stanBF_obj_diff</span><span class="op">$</span><span class="va">BF</span>
<span class="co">#&gt; [1] 0.007149727</span></code></pre></div>
</div>
<div id="stan-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#stan-objects" class="anchor"></a>Stan objects</h2>
<p>rstanBF objects contain <code>stanfit</code> objects (one under <span class="math inline">\(H_1\)</span>, one under <span class="math inline">\(H_2\)</span>), which are actually the outputs of Stan sampling procedure.</p>
<p>They are available under the <code>stanfit</code> property:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stanBF_obj_same</span><span class="op">$</span><span class="va">stanfit</span><span class="op">$</span><span class="va">H1</span>
<span class="va">stanBF_obj_same</span><span class="op">$</span><span class="va">stanfit</span><span class="op">$</span><span class="va">H2</span></code></pre></div>
<p>One can either further process them using standard tools (<code>rstan</code> post-processing functions, <code>coda</code>, etc.), or use the supplied functions in the package.</p>
<p>These functions usually do different things depending on the model (e.g. often only the likelihood).</p>
</div>
<div id="post-processing" class="section level2">
<h2 class="hasAnchor">
<a href="#post-processing" class="anchor"></a>Post-processing</h2>
<p>What follows must be implemented for each model.<br>
For now, only <code>stanBF_turn</code> models are completely specified.</p>
<div id="posteriors" class="section level3">
<h3 class="hasAnchor">
<a href="#posteriors" class="anchor"></a>Posteriors</h3>
<p>Returned objects often implement a <code>samples</code> method to extract samples from the interesting posteriors:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">rstanBF</span><span class="fu">::</span><span class="fu"><a href="../reference/samples.html">samples</a></span><span class="op">(</span><span class="va">stanBF_obj_same</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 13</span>
<span class="co">#&gt;   Iteration Hypothesis Source `theta[1]` `theta[2]` `theta[3]` `theta[4]`</span>
<span class="co">#&gt;       &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1         1 Hp         Both        0.164      0.282      0.345      0.137</span>
<span class="co">#&gt; 2         2 Hp         Both        0.174      0.236      0.313      0.106</span>
<span class="co">#&gt; 3         3 Hp         Both        0.207      0.301      0.269      0.110</span>
<span class="co">#&gt; 4         4 Hp         Both        0.129      0.259      0.322      0.142</span>
<span class="co">#&gt; 5         5 Hp         Both        0.120      0.343      0.285      0.133</span>
<span class="co">#&gt; 6         6 Hp         Both        0.129      0.282      0.356      0.135</span>
<span class="co">#&gt; # … with 6 more variables: theta[5] &lt;dbl&gt;, rho[1] &lt;dbl&gt;, rho[2] &lt;dbl&gt;,</span>
<span class="co">#&gt; #   rho[3] &lt;dbl&gt;, rho[4] &lt;dbl&gt;, rho[5] &lt;dbl&gt;</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">rstanBF</span><span class="fu">::</span><span class="fu"><a href="../reference/samples.html">samples</a></span><span class="op">(</span><span class="va">stanBF_obj_diff</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 13</span>
<span class="co">#&gt;   Iteration Hypothesis Source `theta[1]` `theta[2]` `theta[3]` `theta[4]`</span>
<span class="co">#&gt;       &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1         1 Hp         Both        0.179      0.250      0.223      0.186</span>
<span class="co">#&gt; 2         2 Hp         Both        0.200      0.290      0.197      0.165</span>
<span class="co">#&gt; 3         3 Hp         Both        0.170      0.191      0.191      0.213</span>
<span class="co">#&gt; 4         4 Hp         Both        0.183      0.368      0.168      0.169</span>
<span class="co">#&gt; 5         5 Hp         Both        0.184      0.238      0.235      0.179</span>
<span class="co">#&gt; 6         6 Hp         Both        0.134      0.280      0.249      0.198</span>
<span class="co">#&gt; # … with 6 more variables: theta[5] &lt;dbl&gt;, rho[1] &lt;dbl&gt;, rho[2] &lt;dbl&gt;,</span>
<span class="co">#&gt; #   rho[3] &lt;dbl&gt;, rho[4] &lt;dbl&gt;, rho[5] &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="plots" class="section level3">
<h3 class="hasAnchor">
<a href="#plots" class="anchor"></a>Plots</h3>
<p>Returned objects often implement a <code>plot_posteriors</code> method:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rstanBF</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_posteriors.html">plot_posteriors</a></span><span class="op">(</span><span class="va">stanBF_obj_same</span>, <span class="st">'theta'</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/HMC-posteriors-plot-1.png" width="672"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rstanBF</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_posteriors.html">plot_posteriors</a></span><span class="op">(</span><span class="va">stanBF_obj_diff</span>, <span class="st">'theta'</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/HMC-posteriors-plot-2.png" width="672"></p>
</div>
<div id="prior-and-posterior-predictive-distributions" class="section level3">
<h3 class="hasAnchor">
<a href="#prior-and-posterior-predictive-distributions" class="anchor"></a>Prior and posterior predictive distributions</h3>
<p>Models often implement draws from the prior and posterior predictive distributions.</p>
<p>Prior predictive: the names of the variables in the Stan source start with <code>sim_</code>.<br>
Posterior predictive: the names of the variables in the Stan source start with <code>pred_</code>.</p>
<p>One can use the <code>prior_pred</code> and <code>posterior_pred</code> methods to extract and format them:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_prior_pred_same</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prior_pred.html">prior_pred</a></span><span class="op">(</span><span class="va">stanBF_obj_same</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_prior_pred_same</span>, <span class="fl">20</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 20 x 7</span>
<span class="co">#&gt;      `x[1]`       `x[2]`      `x[3]`      `x[4]`   `x[5]` Hypothesis Source</span>
<span class="co">#&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt; </span>
<span class="co">#&gt;  1 5.28e- 2 0.0715       0.0309      0.820       2.45e- 2 Hp         Both  </span>
<span class="co">#&gt;  2 9.01e- 5 0.0122       0.171       0.762       5.39e- 2 Hp         Both  </span>
<span class="co">#&gt;  3 9.39e- 2 0.0105       0.302       0.386       2.08e- 1 Hp         Both  </span>
<span class="co">#&gt;  4 2.25e- 3 0.000231     0.849       0.116       3.24e- 2 Hp         Both  </span>
<span class="co">#&gt;  5 2.36e- 4 0.914        0.0818      0.00324     6.61e- 4 Hp         Both  </span>
<span class="co">#&gt;  6 9.34e- 5 0.0000549    0.144       0.000000270 8.56e- 1 Hp         Both  </span>
<span class="co">#&gt;  7 3.49e- 1 0.239        0.0957      0.280       3.70e- 2 Hp         Both  </span>
<span class="co">#&gt;  8 3.76e- 1 0.00193      0.0734      0.345       2.04e- 1 Hp         Both  </span>
<span class="co">#&gt;  9 4.67e- 1 0.282        0.0493      0.00134     2.00e- 1 Hp         Both  </span>
<span class="co">#&gt; 10 3.08e- 2 0.0000502    0.000000729 0.0158      9.53e- 1 Hp         Both  </span>
<span class="co">#&gt; 11 2.17e- 9 0.00185      0.0426      0.956       1.89e-14 Hp         Both  </span>
<span class="co">#&gt; 12 9.85e- 1 0.0000000536 0.0138      0.000921    7.13e- 4 Hp         Both  </span>
<span class="co">#&gt; 13 2.74e- 1 0.136        0.00000385  0.155       4.34e- 1 Hp         Both  </span>
<span class="co">#&gt; 14 8.57e- 1 0.0163       0.000699    0.000850    1.25e- 1 Hp         Both  </span>
<span class="co">#&gt; 15 9.16e- 3 0.215        0.000000729 0.438       3.37e- 1 Hp         Both  </span>
<span class="co">#&gt; 16 3.50e- 1 0.00785      0.641       0.000382    1.28e- 3 Hp         Both  </span>
<span class="co">#&gt; 17 1.26e-13 0.00129      0.765       0.000116    2.34e- 1 Hp         Both  </span>
<span class="co">#&gt; 18 3.33e- 5 0.00142      0.113       0.675       2.10e- 1 Hp         Both  </span>
<span class="co">#&gt; 19 4.46e- 1 0.00171      0.0152      0.00138     5.36e- 1 Hp         Both  </span>
<span class="co">#&gt; 20 6.74e- 1 0.000234     0.0148      0.0987      2.13e- 1 Hp         Both</span></code></pre></div>
<p>This is interpreted as an example of a dataset, generated according to the model, before having observed any data.</p>
<p>They can be used to assess if the specified hyperparameters are too restrictive or too wide.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_posterior_pred_same</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_pred.html">posterior_pred</a></span><span class="op">(</span><span class="va">stanBF_obj_same</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_posterior_pred_same</span>, <span class="fl">20</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 20 x 7</span>
<span class="co">#&gt;      `x[1]` `x[2]`    `x[3]`   `x[4]`   `x[5]` Hypothesis Source</span>
<span class="co">#&gt;       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt; </span>
<span class="co">#&gt;  1 6.90e-10 0.905  0.0180    6.35e- 2 1.38e- 2 Hp         Both  </span>
<span class="co">#&gt;  2 1.91e- 2 0.876  0.0527    5.21e- 8 5.18e- 2 Hp         Both  </span>
<span class="co">#&gt;  3 3.65e- 1 0.259  0.341     3.52e- 2 8.31e- 8 Hp         Both  </span>
<span class="co">#&gt;  4 4.05e- 1 0.245  0.350     1.76e- 5 1.83e- 5 Hp         Both  </span>
<span class="co">#&gt;  5 1.70e- 1 0.660  0.121     5.55e- 8 4.88e- 2 Hp         Both  </span>
<span class="co">#&gt;  6 3.91e- 2 0.924  0.0359    1.01e- 3 6.24e- 5 Hp         Both  </span>
<span class="co">#&gt;  7 3.36e- 3 0.0907 0.0253    2.05e- 5 8.81e- 1 Hp         Both  </span>
<span class="co">#&gt;  8 2.49e- 1 0.644  0.0000136 1.07e- 1 3.73e- 4 Hp         Both  </span>
<span class="co">#&gt;  9 6.72e- 1 0.168  0.150     9.47e- 3 3.08e- 4 Hp         Both  </span>
<span class="co">#&gt; 10 7.13e- 4 0.527  0.0331    4.39e- 1 4.99e- 6 Hp         Both  </span>
<span class="co">#&gt; 11 5.55e- 5 0.177  0.818     4.50e- 3 1.34e- 6 Hp         Both  </span>
<span class="co">#&gt; 12 1.95e- 2 0.954  0.00783   1.15e- 2 7.54e- 3 Hp         Both  </span>
<span class="co">#&gt; 13 9.16e- 3 0.170  0.696     1.24e- 1 4.93e- 9 Hp         Both  </span>
<span class="co">#&gt; 14 2.56e- 1 0.0949 0.649     7.27e-26 3.89e- 8 Hp         Both  </span>
<span class="co">#&gt; 15 3.35e- 3 0.692  0.183     1.22e- 1 2.32e-15 Hp         Both  </span>
<span class="co">#&gt; 16 1.55e- 1 0.183  0.304     7.18e- 3 3.51e- 1 Hp         Both  </span>
<span class="co">#&gt; 17 2.17e- 1 0.588  0.00406   1.07e- 6 1.91e- 1 Hp         Both  </span>
<span class="co">#&gt; 18 1.19e- 1 0.396  0.479     5.50e- 3 1.44e-15 Hp         Both  </span>
<span class="co">#&gt; 19 3.06e- 5 0.0770 0.794     1.25e- 1 3.48e- 3 Hp         Both  </span>
<span class="co">#&gt; 20 2.12e- 3 0.203  0.169     6.10e- 1 1.64e- 2 Hp         Both</span></code></pre></div>
</div>
<div id="rstan-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#rstan-functions" class="anchor"></a>rstan functions</h3>
<p><code>stanfit</code> objects implement several plotting functions (see <a href="http://mc-stan.org/rstan/reference/plotting-functions.html" class="external-link">here</a> for a reference).<br>
For example, traceplots:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># A stanfit object</span>
<span class="co"># stanBF_obj_same$stanfit$H1</span>

<span class="co"># Plot using all params</span>
<span class="va">stanBF_obj_diff</span><span class="op">$</span><span class="va">stanfit</span><span class="op">$</span><span class="va">H1</span> <span class="op">%&gt;%</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stan_plot.html" class="external-link">stan_trace</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 'pars' not specified. Showing first 10 parameters by default.</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stanBF_obj_diff</span><span class="op">$</span><span class="va">stanfit</span><span class="op">$</span><span class="va">H2</span> <span class="op">%&gt;%</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stan_plot.html" class="external-link">stan_trace</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 'pars' not specified. Showing first 10 parameters by default.</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-9-2.png" width="672"></p>
</div>
<div id="bayesplot" class="section level3">
<h3 class="hasAnchor">
<a href="#bayesplot" class="anchor"></a>bayesplot</h3>
<p>The popular <a href="http://mc-stan.org/bayesplot" class="external-link">bayesplot</a> package can be used to produce plots to assess convergence of the MCMC chains. It includes an interface to <code>stanfit</code> objects, returned by rstan.</p>
<p>It is easy to use <code>bayesplot</code> with this package. One must first extract all MCMC samples using the <code>rstan</code> tools:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span>
<span class="co">#&gt; This is bayesplot version 1.8.0</span>
<span class="co">#&gt; - Online documentation and vignettes at mc-stan.org/bayesplot</span>
<span class="co">#&gt; - bayesplot theme set to bayesplot::theme_default()</span>
<span class="co">#&gt;    * Does _not_ affect other ggplot2 plots</span>
<span class="co">#&gt;    * See ?bayesplot_theme_set for details on theme setting</span>

<span class="co"># A stanfit object</span>
<span class="co"># stanBF_obj_same$stanfit$H1</span>

<span class="co"># All variables except the logPosterior</span>
<span class="va">all_vars_no_lp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">stanBF_obj_same</span><span class="op">$</span><span class="va">stanfit</span><span class="op">$</span><span class="va">H2</span><span class="op">)</span>, <span class="st">'lp__'</span><span class="op">)</span>
<span class="va">all_vars_no_lp</span>
<span class="co">#&gt;  [1] "theta_ref[1]"       "theta_ref[2]"       "theta_ref[3]"      </span>
<span class="co">#&gt;  [4] "theta_ref[4]"       "theta_ref[5]"       "theta_quest[1]"    </span>
<span class="co">#&gt;  [7] "theta_quest[2]"     "theta_quest[3]"     "theta_quest[4]"    </span>
<span class="co">#&gt; [10] "theta_quest[5]"     "sim_d_ref[1]"       "sim_d_ref[2]"      </span>
<span class="co">#&gt; [13] "sim_d_ref[3]"       "sim_d_ref[4]"       "sim_d_ref[5]"      </span>
<span class="co">#&gt; [16] "sim_d_quest[1]"     "sim_d_quest[2]"     "sim_d_quest[3]"    </span>
<span class="co">#&gt; [19] "sim_d_quest[4]"     "sim_d_quest[5]"     "sim_theta_ref[1]"  </span>
<span class="co">#&gt; [22] "sim_theta_ref[2]"   "sim_theta_ref[3]"   "sim_theta_ref[4]"  </span>
<span class="co">#&gt; [25] "sim_theta_ref[5]"   "sim_theta_quest[1]" "sim_theta_quest[2]"</span>
<span class="co">#&gt; [28] "sim_theta_quest[3]" "sim_theta_quest[4]" "sim_theta_quest[5]"</span>
<span class="co">#&gt; [31] "pred_d_ref[1]"      "pred_d_ref[2]"      "pred_d_ref[3]"     </span>
<span class="co">#&gt; [34] "pred_d_ref[4]"      "pred_d_ref[5]"      "pred_d_quest[1]"   </span>
<span class="co">#&gt; [37] "pred_d_quest[2]"    "pred_d_quest[3]"    "pred_d_quest[4]"   </span>
<span class="co">#&gt; [40] "pred_d_quest[5]"</span>

<span class="va">outputs_H1</span> <span class="op">&lt;-</span> <span class="va">stanBF_obj_same</span><span class="op">$</span><span class="va">stanfit</span><span class="op">$</span><span class="va">H1</span> <span class="op">%&gt;%</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/As.mcmc.list.html" class="external-link">As.mcmc.list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">outputs_H2</span> <span class="op">&lt;-</span> <span class="va">stanBF_obj_same</span><span class="op">$</span><span class="va">stanfit</span><span class="op">$</span><span class="va">H2</span> <span class="op">%&gt;%</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/As.mcmc.list.html" class="external-link">As.mcmc.list</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Equivalent:</span>
<span class="co"># outputs_H1 &lt;- stanBF_obj_same$stanfit$H1 %&gt;% rstan::extract(pars = all_vars_no_lp)</span>
<span class="co"># outputs_H2 &lt;- stanBF_obj_same$stanfit$H2 %&gt;% rstan::extract(pars = all_vars_no_lp)</span></code></pre></div>
<p>Then, one can use <code>bayesplot</code> methods. (see the <a href="http://mc-stan.org/bayesplot/reference/MCMC-overview.html" class="external-link">documentation</a>)<br>
As an example, we can plot the posterior densities across MCMC chains, selecting only the <code>theta_ref</code> parameters:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Density across chains</span>
<span class="co"># use a regular expression to subset the interesting variables</span>
<span class="va">outputs_H1</span> <span class="op">%&gt;%</span> <span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-distributions.html" class="external-link">mcmc_dens_overlay</a></span><span class="op">(</span>regex_pars <span class="op">=</span> <span class="st">'^theta_ref'</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<div id="parameter-value-checks" class="section level4">
<h4 class="hasAnchor">
<a href="#parameter-value-checks" class="anchor"></a>Parameter value checks</h4>
<p><code>bayesplot</code> contains methods to overlay generating values to posterior distributions.</p>
<p>Let’s try for <span class="math inline">\(\boldsymbol{\theta_i}\)</span> (see the <a href="Dirichlet-Dirichlet%20model,%20and%20tests">Dirichlet-Dirichlet model</a> vignette).</p>
<p>Using data generated under <span class="math inline">\(H_1\)</span>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Collect the true values</span>
<span class="va">df_source_same</span> <span class="op">&lt;-</span> <span class="va">list_pop</span><span class="op">$</span><span class="va">df_sources</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">source</span> <span class="op">==</span> <span class="va">source_same</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">source</span><span class="op">)</span>
<span class="va">df_source_same</span>
<span class="co">#&gt; # A tibble: 1 x 5</span>
<span class="co">#&gt;   `theta[1]` `theta[2]` `theta[3]` `theta[4]` `theta[5]`</span>
<span class="co">#&gt;        &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1      0.139      0.268      0.361      0.114      0.118</span>

<span class="va">true_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_source_same</span><span class="op">)</span>
<span class="va">draws_same</span> <span class="op">&lt;-</span> <span class="va">stanBF_obj_same</span><span class="op">$</span><span class="va">stanfit</span><span class="op">$</span><span class="va">H1</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="st">'theta_ref'</span><span class="op">)</span>

<span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-recover.html" class="external-link">mcmc_recover_intervals</a></span><span class="op">(</span><span class="va">draws_same</span>, <span class="va">true_vals</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Lorenzo Gaborini.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
