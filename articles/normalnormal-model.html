<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Normal-Normal model • rstanBF</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Normal-Normal model">
<meta property="og:description" content="rstanBF">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rstanBF</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/dirichletdirichlet-model.html">Dirichlet-Dirichlet model, and tests</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Introduction and usage</a>
    </li>
    <li>
      <a href="../articles/normalnormal-model.html">Normal-Normal model</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="normalnormal-model_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Normal-Normal model</h1>
                        <h4 data-toc-skip class="author">LG</h4>
            
            <h4 data-toc-skip class="date">2021-03-09</h4>
      
      
      <div class="hidden name"><code>normalnormal-model.Rmd</code></div>

    </div>

    
    

<p>This vignette introduces the Normal-Normal model. It is designed to be a benchmark.</p>
<div id="model" class="section level2">
<h2 class="hasAnchor">
<a href="#model" class="anchor"></a>Model</h2>
<p>Consider Normal samples <span class="math inline">\(X_i\)</span> from <span class="math inline">\(m\)</span> different sources. Each source is sampled <span class="math inline">\(n\)</span> times.<br>
Dirichlet parameter are also assumed to be sampled from Dirichlet distributions.</p>
<ul>
<li>
<span class="math inline">\(\boldsymbol{X}_{ij} \sim N(\mu_i, \sigma_i)\)</span> iid <span class="math inline">\(\forall j = 1, \ldots, n\)</span> with <span class="math inline">\(i = 1, \ldots, m\)</span>
</li>
<li><span class="math inline">\(\mu_i \sim N(\mu_0^{(\mu)}, \sigma_0^{(\mu)}) \quad \forall i = 1, \ldots, m\)</span></li>
<li><span class="math inline">\(\sigma_i \sim N(\mu_0^{(\sigma)}, \sigma_0^{(\sigma)}) \quad \forall i = 1, \ldots, m\)</span></li>
</ul>
<p>We assume that <span class="math inline">\(\mu_0^{(\mu)}, \sigma_0^{(\mu)}, \mu_0^{(\sigma)}, \sigma_0^{(\sigma)}\)</span> are known.</p>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>The Normal-Normal model is implemented in <code>rsamplestudy</code>.<br>
Let’s generate some data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lgaborini/rsamplestudy" class="external-link">rsamplestudy</a></span><span class="op">)</span>

<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">5</span>
<span class="va">list_pop</span> <span class="op">&lt;-</span> <span class="fu">rsamplestudy</span><span class="fu">::</span><span class="fu"><a href="https://lgaborini.github.io/rsamplestudy/reference/fun_rnorm_population.html" class="external-link">fun_rnorm_population</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">m</span><span class="op">)</span>

<span class="va">list_pop</span><span class="op">$</span><span class="va">df_pop</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">source</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">source</span><span class="op">)</span><span class="op">)</span>, position <span class="op">=</span> <span class="st">'jitter'</span><span class="op">)</span></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="va">list_pop</span><span class="op">$</span><span class="va">df_sources</span>
<span class="co">#&gt; # A tibble: 5 x 3</span>
<span class="co">#&gt;   source    mu sigma</span>
<span class="co">#&gt;    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1      1  1.13 0.209</span>
<span class="co">#&gt; 2      2  1.15 0.547</span>
<span class="co">#&gt; 3      3  3.18 0.426</span>
<span class="co">#&gt; 4      4  2.15 0.246</span>
<span class="co">#&gt; 5      5  2.47 0.561</span>

<span class="va">list_pop</span><span class="op">$</span><span class="va">list_hyper</span>
<span class="co">#&gt; $m_mu</span>
<span class="co">#&gt; [1] 2.287247</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $m_sigma</span>
<span class="co">#&gt; [1] 1.196772</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $s_mu</span>
<span class="co">#&gt; [1] -0.6942925</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $s_sigma</span>
<span class="co">#&gt; [1] 0.412293</span></code></pre></div>
<p>Generate two sets of samples, under two different hypotheses:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">k_ref</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">k_quest</span> <span class="op">&lt;-</span> <span class="fl">10</span>

<span class="va">source_ref</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">source_same</span> <span class="op">&lt;-</span> <span class="va">source_ref</span>
<span class="va">source_diff</span> <span class="op">&lt;-</span> <span class="fl">3</span>             <span class="co"># single questioned different source</span>
<span class="va">list_samples_same</span> <span class="op">&lt;-</span> <span class="fu">rsamplestudy</span><span class="fu">::</span><span class="fu"><a href="https://lgaborini.github.io/rsamplestudy/reference/make_dataset_splits.html" class="external-link">make_dataset_splits</a></span><span class="op">(</span><span class="va">list_pop</span><span class="op">$</span><span class="va">df_pop</span>, <span class="va">k_ref</span>, <span class="va">k_quest</span>, source_ref <span class="op">=</span> <span class="va">source_ref</span>, source_quest <span class="op">=</span> <span class="va">source_same</span><span class="op">)</span>
<span class="va">list_samples_diff</span> <span class="op">&lt;-</span> <span class="fu">rsamplestudy</span><span class="fu">::</span><span class="fu"><a href="https://lgaborini.github.io/rsamplestudy/reference/make_dataset_splits.html" class="external-link">make_dataset_splits</a></span><span class="op">(</span><span class="va">list_pop</span><span class="op">$</span><span class="va">df_pop</span>, <span class="va">k_ref</span>, <span class="va">k_quest</span>, source_ref <span class="op">=</span> <span class="va">source_ref</span>, source_quest <span class="op">=</span> <span class="va">source_diff</span><span class="op">)</span></code></pre></div>
<p>Organize data, and elicit the hyperprior from the background data (assume vague hyperpriors):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">list_data_same</span> <span class="op">&lt;-</span> <span class="fu">rstanBF</span><span class="fu">::</span><span class="fu"><a href="../reference/stanBF_prepare_rsamplestudy_data.html">stanBF_prepare_rsamplestudy_data</a></span><span class="op">(</span><span class="va">list_pop</span>, <span class="va">list_samples_same</span><span class="op">)</span>
<span class="va">list_data_diff</span> <span class="op">&lt;-</span> <span class="fu">rstanBF</span><span class="fu">::</span><span class="fu"><a href="../reference/stanBF_prepare_rsamplestudy_data.html">stanBF_prepare_rsamplestudy_data</a></span><span class="op">(</span><span class="va">list_pop</span>, <span class="va">list_samples_diff</span><span class="op">)</span>
<span class="va">list_hyper</span> <span class="op">&lt;-</span> <span class="fu">rstanBF</span><span class="fu">::</span><span class="fu"><a href="../reference/stanBF_elicit_hyperpriors.html">stanBF_elicit_hyperpriors</a></span><span class="op">(</span><span class="va">list_samples_same</span><span class="op">$</span><span class="va">df_background</span>, <span class="st">'NormNorm'</span>, <span class="st">'vague'</span><span class="op">)</span></code></pre></div>
<p>Perform the NUTS sampling:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n.iter</span> <span class="op">&lt;-</span> <span class="fl">5000</span>
<span class="va">n.burnin</span> <span class="op">&lt;-</span> <span class="fl">1000</span>
<span class="va">n.cores</span> <span class="op">&lt;-</span> <span class="fl">3</span>
<span class="va">n.chains</span> <span class="op">&lt;-</span> <span class="va">n.cores</span>
<span class="va">obj_StanBF_same</span> <span class="op">&lt;-</span> <span class="fu">rstanBF</span><span class="fu">::</span><span class="fu"><a href="../reference/compute_BF_Stan.html">compute_BF_Stan</a></span><span class="op">(</span><span class="va">list_data_same</span>, <span class="st">'NormNorm'</span>, <span class="va">list_hyper</span>, n.iter <span class="op">=</span> <span class="va">n.iter</span>, n.burnin <span class="op">=</span> <span class="va">n.burnin</span>, n.cores <span class="op">=</span> <span class="va">n.cores</span>, n.chains <span class="op">=</span> <span class="va">n.chains</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">obj_StanBF_diff</span> <span class="op">&lt;-</span> <span class="fu">rstanBF</span><span class="fu">::</span><span class="fu"><a href="../reference/compute_BF_Stan.html">compute_BF_Stan</a></span><span class="op">(</span><span class="va">list_data_diff</span>, <span class="st">'NormNorm'</span>, <span class="va">list_hyper</span>, n.iter <span class="op">=</span> <span class="va">n.iter</span>, n.burnin <span class="op">=</span> <span class="va">n.burnin</span>, n.cores <span class="op">=</span> <span class="va">n.cores</span>, n.chains <span class="op">=</span> <span class="va">n.chains</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obj_StanBF_same</span>
<span class="co">#&gt; stanBF object containing posterior samples from H1, H2.</span>
<span class="co">#&gt; Model: Normal-Normal </span>
<span class="co">#&gt; Obtained BF: 1697753 </span>
<span class="co">#&gt; Ran with 3 chains, 5000 HMC iterations.</span>
<span class="va">obj_StanBF_diff</span>
<span class="co">#&gt; stanBF object containing posterior samples from H1, H2.</span>
<span class="co">#&gt; Model: Normal-Normal </span>
<span class="co">#&gt; Obtained BF: 1.301013e-05 </span>
<span class="co">#&gt; Ran with 3 chains, 5000 HMC iterations.</span></code></pre></div>
<p>More details on the Stan outputs:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obj_StanBF_same</span><span class="op">$</span><span class="va">stanfit</span>
<span class="co">#&gt; $H1</span>
<span class="co">#&gt; Inference for Stan model: stan_NormNorm_H1.</span>
<span class="co">#&gt; 3 chains, each with iter=5000; warmup=1000; thin=1; </span>
<span class="co">#&gt; post-warmup draws per chain=4000, total post-warmup draws=12000.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                mean se_mean     sd    2.5%    25%   50%    75%  97.5% n_eff</span>
<span class="co">#&gt; mu_ref         1.09    0.00   0.04    1.00   1.06  1.09   1.12   1.18  7517</span>
<span class="co">#&gt; sigma_ref      0.19    0.00   0.03    0.14   0.17  0.19   0.21   0.27  6888</span>
<span class="co">#&gt; sim_mu_ref     2.47    0.93 100.43 -194.84 -64.44  2.77  69.74 198.64 11659</span>
<span class="co">#&gt; sim_sigma_ref 79.93    0.55  60.26    3.48  31.20 68.20 115.00 223.64 12182</span>
<span class="co">#&gt; sim_d_ref      1.04    1.30 142.27 -284.03 -85.48  1.73  88.28 280.44 11962</span>
<span class="co">#&gt; pred_d_ref     1.09    0.00   0.20    0.69   0.96  1.09   1.22   1.49 11329</span>
<span class="co">#&gt; lp__          -7.95    0.02   1.05  -10.80  -8.36 -7.62  -7.19  -6.91  4637</span>
<span class="co">#&gt;               Rhat</span>
<span class="co">#&gt; mu_ref           1</span>
<span class="co">#&gt; sigma_ref        1</span>
<span class="co">#&gt; sim_mu_ref       1</span>
<span class="co">#&gt; sim_sigma_ref    1</span>
<span class="co">#&gt; sim_d_ref        1</span>
<span class="co">#&gt; pred_d_ref       1</span>
<span class="co">#&gt; lp__             1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Tue Mar  9 09:14:30 2021.</span>
<span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span>
<span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span>
<span class="co">#&gt; convergence, Rhat=1).</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $H2</span>
<span class="co">#&gt; Inference for Stan model: stan_NormNorm_H2.</span>
<span class="co">#&gt; 3 chains, each with iter=5000; warmup=1000; thin=1; </span>
<span class="co">#&gt; post-warmup draws per chain=4000, total post-warmup draws=12000.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                   mean se_mean     sd    2.5%    25%    50%    75%  97.5% n_eff</span>
<span class="co">#&gt; mu_ref            1.11    0.00   0.06    1.00   1.07   1.11   1.14   1.22  9360</span>
<span class="co">#&gt; sigma_ref         0.17    0.00   0.05    0.10   0.14   0.16   0.19   0.29  7665</span>
<span class="co">#&gt; mu_quest          1.07    0.00   0.08    0.91   1.02   1.07   1.13   1.24  7677</span>
<span class="co">#&gt; sigma_quest       0.25    0.00   0.07    0.15   0.20   0.24   0.28   0.43  7074</span>
<span class="co">#&gt; sim_mu_ref       -1.24    0.96 100.48 -197.19 -68.85  -1.96  66.14 196.53 10924</span>
<span class="co">#&gt; sim_sigma_ref    79.45    0.55  59.72    3.43  31.57  67.96 114.67 222.73 11592</span>
<span class="co">#&gt; sim_mu_quest      0.20    0.93  99.99 -192.64 -67.50  -0.70  67.63 197.41 11549</span>
<span class="co">#&gt; sim_sigma_quest  80.28    0.55  60.93    2.73  32.21  67.75 115.46 226.50 12178</span>
<span class="co">#&gt; sim_d_ref        -0.41    1.36 142.25 -280.41 -87.49  -1.17  87.24 285.12 10973</span>
<span class="co">#&gt; sim_d_quest       1.46    1.32 143.05 -286.81 -86.95   0.42  88.71 286.26 11805</span>
<span class="co">#&gt; pred_d_ref        1.11    0.00   0.19    0.73   0.99   1.11   1.22   1.48 10935</span>
<span class="co">#&gt; pred_d_quest      1.08    0.00   0.27    0.53   0.91   1.08   1.25   1.62 11669</span>
<span class="co">#&gt; lp__            -21.84    0.02   1.54  -25.76 -22.61 -21.50 -20.70 -19.87  4920</span>
<span class="co">#&gt;                 Rhat</span>
<span class="co">#&gt; mu_ref             1</span>
<span class="co">#&gt; sigma_ref          1</span>
<span class="co">#&gt; mu_quest           1</span>
<span class="co">#&gt; sigma_quest        1</span>
<span class="co">#&gt; sim_mu_ref         1</span>
<span class="co">#&gt; sim_sigma_ref      1</span>
<span class="co">#&gt; sim_mu_quest       1</span>
<span class="co">#&gt; sim_sigma_quest    1</span>
<span class="co">#&gt; sim_d_ref          1</span>
<span class="co">#&gt; sim_d_quest        1</span>
<span class="co">#&gt; pred_d_ref         1</span>
<span class="co">#&gt; pred_d_quest       1</span>
<span class="co">#&gt; lp__               1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Tue Mar  9 09:14:32 2021.</span>
<span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span>
<span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span>
<span class="co">#&gt; convergence, Rhat=1).</span>

<span class="va">obj_StanBF_diff</span><span class="op">$</span><span class="va">stanfit</span>
<span class="co">#&gt; $H1</span>
<span class="co">#&gt; Inference for Stan model: stan_NormNorm_H1.</span>
<span class="co">#&gt; 3 chains, each with iter=5000; warmup=1000; thin=1; </span>
<span class="co">#&gt; post-warmup draws per chain=4000, total post-warmup draws=12000.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                 mean se_mean     sd    2.5%    25%    50%    75%  97.5% n_eff</span>
<span class="co">#&gt; mu_ref          2.19    0.00   0.25    1.70   2.03   2.19   2.36   2.70  7447</span>
<span class="co">#&gt; sigma_ref       1.12    0.00   0.20    0.81   0.98   1.09   1.23   1.58  7281</span>
<span class="co">#&gt; sim_mu_ref     -0.41    0.93 100.57 -196.93 -68.39  -0.69  67.03 197.12 11648</span>
<span class="co">#&gt; sim_sigma_ref  80.93    0.56  60.62    3.18  32.83  69.40 116.19 225.55 11684</span>
<span class="co">#&gt; sim_d_ref      -0.69    1.32 141.43 -282.72 -87.36   0.08  86.50 272.43 11558</span>
<span class="co">#&gt; pred_d_ref      2.20    0.01   1.17   -0.13   1.44   2.21   2.95   4.53 10868</span>
<span class="co">#&gt; lp__          -41.51    0.01   1.02  -44.20 -41.92 -41.20 -40.78 -40.50  5088</span>
<span class="co">#&gt;               Rhat</span>
<span class="co">#&gt; mu_ref           1</span>
<span class="co">#&gt; sigma_ref        1</span>
<span class="co">#&gt; sim_mu_ref       1</span>
<span class="co">#&gt; sim_sigma_ref    1</span>
<span class="co">#&gt; sim_d_ref        1</span>
<span class="co">#&gt; pred_d_ref       1</span>
<span class="co">#&gt; lp__             1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Tue Mar  9 09:14:39 2021.</span>
<span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span>
<span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span>
<span class="co">#&gt; convergence, Rhat=1).</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $H2</span>
<span class="co">#&gt; Inference for Stan model: stan_NormNorm_H2.</span>
<span class="co">#&gt; 3 chains, each with iter=5000; warmup=1000; thin=1; </span>
<span class="co">#&gt; post-warmup draws per chain=4000, total post-warmup draws=12000.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                   mean se_mean     sd    2.5%    25%    50%    75%  97.5% n_eff</span>
<span class="co">#&gt; mu_ref            1.21    0.00   0.08    1.06   1.16   1.21   1.25   1.36  7315</span>
<span class="co">#&gt; sigma_ref         0.23    0.00   0.07    0.14   0.18   0.22   0.26   0.39  6579</span>
<span class="co">#&gt; mu_quest          3.18    0.00   0.13    2.91   3.09   3.17   3.26   3.45  8651</span>
<span class="co">#&gt; sigma_quest       0.41    0.00   0.12    0.25   0.33   0.39   0.46   0.69  7623</span>
<span class="co">#&gt; sim_mu_ref        0.32    0.91 100.59 -196.72 -67.28   0.02  67.83 198.17 12133</span>
<span class="co">#&gt; sim_sigma_ref    80.40    0.55  60.40    3.35  31.81  68.68 116.72 223.96 11976</span>
<span class="co">#&gt; sim_mu_quest      0.63    0.93 100.64 -195.99 -67.32   0.58  68.27 201.36 11780</span>
<span class="co">#&gt; sim_sigma_quest  80.44    0.56  60.93    3.11  31.79  68.24 115.19 225.33 11887</span>
<span class="co">#&gt; sim_d_ref        -0.23    1.29 141.78 -281.99 -85.88  -0.99  85.11 285.31 12137</span>
<span class="co">#&gt; sim_d_quest       1.54    1.29 143.20 -277.84 -88.42   0.58  87.72 289.70 12331</span>
<span class="co">#&gt; pred_d_ref        1.21    0.00   0.25    0.72   1.05   1.21   1.36   1.71 12119</span>
<span class="co">#&gt; pred_d_quest      3.18    0.00   0.45    2.29   2.90   3.18   3.45   4.07 12004</span>
<span class="co">#&gt; lp__            -28.82    0.03   1.58  -32.87 -29.57 -28.47 -27.66 -26.88  3785</span>
<span class="co">#&gt;                 Rhat</span>
<span class="co">#&gt; mu_ref             1</span>
<span class="co">#&gt; sigma_ref          1</span>
<span class="co">#&gt; mu_quest           1</span>
<span class="co">#&gt; sigma_quest        1</span>
<span class="co">#&gt; sim_mu_ref         1</span>
<span class="co">#&gt; sim_sigma_ref      1</span>
<span class="co">#&gt; sim_mu_quest       1</span>
<span class="co">#&gt; sim_sigma_quest    1</span>
<span class="co">#&gt; sim_d_ref          1</span>
<span class="co">#&gt; sim_d_quest        1</span>
<span class="co">#&gt; pred_d_ref         1</span>
<span class="co">#&gt; pred_d_quest       1</span>
<span class="co">#&gt; lp__               1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Tue Mar  9 09:14:41 2021.</span>
<span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span>
<span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span>
<span class="co">#&gt; convergence, Rhat=1).</span></code></pre></div>
</div>
<div id="post-processing" class="section level2">
<h2 class="hasAnchor">
<a href="#post-processing" class="anchor"></a>Post-processing</h2>
<p>Using general post-processing utils in <code>bayesplot</code> package:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan" class="external-link">rstan</a></span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span>
<span class="co">#&gt; This is bayesplot version 1.8.0</span>
<span class="co">#&gt; - Online documentation and vignettes at mc-stan.org/bayesplot</span>
<span class="co">#&gt; - bayesplot theme set to bayesplot::theme_default()</span>
<span class="co">#&gt;    * Does _not_ affect other ggplot2 plots</span>
<span class="co">#&gt;    * See ?bayesplot_theme_set for details on theme setting</span>

<span class="va">results_same_H1</span> <span class="op">&lt;-</span> <span class="va">obj_StanBF_same</span><span class="op">$</span><span class="va">stanfit</span><span class="op">$</span><span class="va">H1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://mc-stan.org/rstan/reference/As.mcmc.list.html" class="external-link">As.mcmc.list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">results_same_H2</span> <span class="op">&lt;-</span> <span class="va">obj_StanBF_same</span><span class="op">$</span><span class="va">stanfit</span><span class="op">$</span><span class="va">H2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://mc-stan.org/rstan/reference/As.mcmc.list.html" class="external-link">As.mcmc.list</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div id="parameter-recovery" class="section level3">
<h3 class="hasAnchor">
<a href="#parameter-recovery" class="anchor"></a>Parameter recovery</h3>
<p>First, we recover NUTS draws and true values. Then we use <code>bayesplot</code> tools to plot them.<br>
Notice that the orders of the variables in <code>mcmc_recover_intervals</code> arguments must match.</p>
<p>Questioned data sampled under <span class="math inline">\(H_1\)</span>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># H1</span>
<span class="va">draws</span> <span class="op">&lt;-</span> <span class="va">obj_StanBF_same</span><span class="op">$</span><span class="va">stanfit</span><span class="op">$</span><span class="va">H1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://mc-stan.org/rstan/reference/As.mcmc.list.html" class="external-link">As.mcmc.list</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'mu_ref'</span>, <span class="st">'sigma_ref'</span><span class="op">)</span><span class="op">)</span>
<span class="va">df_sources_ref</span> <span class="op">&lt;-</span> <span class="va">list_pop</span><span class="op">$</span><span class="va">df_sources</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">source</span> <span class="op">==</span> <span class="va">source_same</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span>
<span class="va">true_sources</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_sources_ref</span><span class="op">)</span>

<span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-recover.html" class="external-link">mcmc_recover_intervals</a></span><span class="op">(</span><span class="va">draws</span>, <span class="va">true_sources</span><span class="op">)</span></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/par-recovery-H1-1.png" width="672"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># H2, reference and questioned</span>
<span class="va">draws</span> <span class="op">&lt;-</span> <span class="va">obj_StanBF_same</span><span class="op">$</span><span class="va">stanfit</span><span class="op">$</span><span class="va">H2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://mc-stan.org/rstan/reference/As.mcmc.list.html" class="external-link">As.mcmc.list</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'mu_ref'</span>, <span class="st">'sigma_ref'</span>, <span class="st">'mu_quest'</span>, <span class="st">'sigma_quest'</span><span class="op">)</span><span class="op">)</span>
<span class="va">df_sources</span> <span class="op">&lt;-</span> <span class="va">list_pop</span><span class="op">$</span><span class="va">df_sources</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">source</span> <span class="op">==</span> <span class="va">source_same</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span>
<span class="va">true_sources</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_sources</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>

<span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-recover.html" class="external-link">mcmc_recover_intervals</a></span><span class="op">(</span><span class="va">draws</span>, <span class="va">true_sources</span><span class="op">)</span></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/par-recovery-H1-2.png" width="672"></p>
<p>Questioned data sampled under <span class="math inline">\(H_2\)</span>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="co"># H1: assuming that sources are the same</span>
<span class="co"># This is not true, so the posteriors do not fit well</span>
<span class="va">draws</span> <span class="op">&lt;-</span> <span class="va">obj_StanBF_diff</span><span class="op">$</span><span class="va">stanfit</span><span class="op">$</span><span class="va">H1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://mc-stan.org/rstan/reference/As.mcmc.list.html" class="external-link">As.mcmc.list</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'mu_ref'</span>, <span class="st">'sigma_ref'</span><span class="op">)</span><span class="op">)</span>
<span class="va">df_sources_ref</span> <span class="op">&lt;-</span> <span class="va">list_pop</span><span class="op">$</span><span class="va">df_sources</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">source</span> <span class="op">==</span> <span class="va">source_same</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span>
<span class="va">true_sources</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_sources_ref</span><span class="op">)</span>

<span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-recover.html" class="external-link">mcmc_recover_intervals</a></span><span class="op">(</span><span class="va">draws</span>, <span class="va">true_sources</span><span class="op">)</span></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/par-recovery-H2-1.png" width="672"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># H2, reference and questioned from different sources</span>
<span class="co"># This is true, the posteriors are also good</span>
<span class="va">draws</span> <span class="op">&lt;-</span> <span class="va">obj_StanBF_diff</span><span class="op">$</span><span class="va">stanfit</span><span class="op">$</span><span class="va">H2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://mc-stan.org/rstan/reference/As.mcmc.list.html" class="external-link">As.mcmc.list</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'mu_ref'</span>, <span class="st">'sigma_ref'</span>, <span class="st">'mu_quest'</span>, <span class="st">'sigma_quest'</span><span class="op">)</span><span class="op">)</span>
<span class="va">df_sources_ref</span> <span class="op">&lt;-</span> <span class="va">list_pop</span><span class="op">$</span><span class="va">df_sources</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">source</span> <span class="op">==</span> <span class="va">source_same</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span>
<span class="va">df_sources_quest</span> <span class="op">&lt;-</span> <span class="va">list_pop</span><span class="op">$</span><span class="va">df_sources</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">source</span> <span class="op">==</span> <span class="va">source_diff</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span>
<span class="va">true_sources</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_sources_ref</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_sources_quest</span><span class="op">)</span><span class="op">)</span>

<span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-recover.html" class="external-link">mcmc_recover_intervals</a></span><span class="op">(</span><span class="va">draws</span>, <span class="va">true_sources</span><span class="op">)</span></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/par-recovery-H2-2.png" width="672"></p>
</div>
<div id="prior-and-posterior-predictive-checks" class="section level3">
<h3 class="hasAnchor">
<a href="#prior-and-posterior-predictive-checks" class="anchor"></a>Prior and posterior predictive checks</h3>
<p>To simplify, consider only when data is sampled from the same source.</p>
<p>Here, we plot the <strong>prior</strong> predictive distribution.<br>
It should generate data which should be realistic, but not necessarily adapted to the observed data.<br>
It represents the background knowledge of our data.</p>
<p>Here, we specified a very vague prior, so the generated values are really extreme compared to the one measured.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># H1: prior predictive</span>
<span class="va">draws_prior</span> <span class="op">&lt;-</span> <span class="va">obj_StanBF_same</span><span class="op">$</span><span class="va">stanfit</span><span class="op">$</span><span class="va">H1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'sim_d_ref'</span><span class="op">)</span><span class="op">)</span>
<span class="va">data_ref</span> <span class="op">&lt;-</span> <span class="va">list_pop</span><span class="op">$</span><span class="va">df_pop</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">source</span> <span class="op">==</span> <span class="va">source_ref</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="st">'x'</span><span class="op">)</span>

<span class="co"># extract a subset of draws</span>
<span class="va">draws_prior_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">draws_prior</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">data_ref</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/PPC-distributions.html" class="external-link">ppc_dens_overlay</a></span><span class="op">(</span><span class="va">data_ref</span>, <span class="va">draws_prior_sub</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 196 rows containing non-finite values (stat_density).</span></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/prior-check-1.png" width="672"></p>
<p>The posterior predictive distribution, instead, should be a good approximation of the observed data.</p>
<p>If it does not occur, it means that the model is not capable of predicting from the correct distribution.<br>
In other words, the trained model is not adapted to the observed data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">draws_posterior</span> <span class="op">&lt;-</span> <span class="va">obj_StanBF_same</span><span class="op">$</span><span class="va">stanfit</span><span class="op">$</span><span class="va">H1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'pred_d_ref'</span><span class="op">)</span><span class="op">)</span>
<span class="va">draws_posterior_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">draws_posterior</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">draws_posterior</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">data_ref</span><span class="op">)</span><span class="op">)</span> <span class="op">]</span><span class="op">)</span><span class="op">)</span>

<span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/PPC-distributions.html" class="external-link">ppc_dens_overlay</a></span><span class="op">(</span><span class="va">data_ref</span>, <span class="va">draws_posterior_sub</span><span class="op">)</span></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/posterior-check-H1-1.png" width="672"></p>
<p>To check that it is working, let’s consider the situation where the sources are different, and consider the reference and questioned items separately.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_quest</span> <span class="op">&lt;-</span> <span class="va">list_pop</span><span class="op">$</span><span class="va">df_pop</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">source</span> <span class="op">==</span> <span class="va">source_diff</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="st">'x'</span><span class="op">)</span>

<span class="co"># Reference data</span>
<span class="va">draws_posterior</span> <span class="op">&lt;-</span> <span class="va">obj_StanBF_diff</span><span class="op">$</span><span class="va">stanfit</span><span class="op">$</span><span class="va">H2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'pred_d_ref'</span><span class="op">)</span><span class="op">)</span>
<span class="va">draws_posterior_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">draws_posterior</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">draws_posterior</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">data_ref</span><span class="op">)</span><span class="op">)</span> <span class="op">]</span><span class="op">)</span><span class="op">)</span>

<span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/PPC-distributions.html" class="external-link">ppc_dens_overlay</a></span><span class="op">(</span><span class="va">data_ref</span>, <span class="va">draws_posterior_sub</span><span class="op">)</span></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/posterior-check-H2-1.png" width="672"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Questioned data</span>
<span class="va">draws_posterior</span> <span class="op">&lt;-</span> <span class="va">obj_StanBF_diff</span><span class="op">$</span><span class="va">stanfit</span><span class="op">$</span><span class="va">H2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'pred_d_quest'</span><span class="op">)</span><span class="op">)</span>
<span class="va">draws_posterior_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">draws_posterior</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">draws_posterior</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">data_quest</span><span class="op">)</span><span class="op">)</span> <span class="op">]</span><span class="op">)</span><span class="op">)</span>

<span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/PPC-distributions.html" class="external-link">ppc_dens_overlay</a></span><span class="op">(</span><span class="va">data_ref</span>, <span class="va">draws_posterior_sub</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'Predicting reference samples with the questioned data'</span><span class="op">)</span></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/posterior-check-H2-2.png" width="672"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/PPC-distributions.html" class="external-link">ppc_dens_overlay</a></span><span class="op">(</span><span class="va">data_quest</span>, <span class="va">draws_posterior_sub</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'Predicting questioned samples with the questioned data'</span><span class="op">)</span></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/posterior-check-H2-3.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Lorenzo Gaborini.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
