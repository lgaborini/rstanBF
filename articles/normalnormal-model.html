<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Normal-Normal model • rstanBF</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Normal-Normal model">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rstanBF</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/dirichletdirichlet-model.html">Dirichlet-Dirichlet model, and tests</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Introduction and usage</a>
    </li>
    <li>
      <a href="../articles/normalnormal-model.html">Normal-Normal model</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Normal-Normal model</h1>
                        <h4 class="author">LG</h4>
            
            <h4 class="date">2019-01-29</h4>
      
      
      <div class="hidden name"><code>normalnormal-model.Rmd</code></div>

    </div>

    
    

<p>This vignette introduces the Normal-Normal model. It is designed to be a benchmark.</p>
<div id="model" class="section level2">
<h2 class="hasAnchor">
<a href="#model" class="anchor"></a>Model</h2>
<p>Consider Normal samples <span class="math inline">\(X_i\)</span> from <span class="math inline">\(m\)</span> different sources. Each source is sampled <span class="math inline">\(n\)</span> times.<br>
Dirichlet parameter are also assumed to be sampled from Dirichlet distributions.</p>
<ul>
<li>
<span class="math inline">\(\boldsymbol{X}_{ij} \sim N(\mu_i, \sigma_i)\)</span> iid <span class="math inline">\(\forall j = 1, \ldots, n\)</span> with <span class="math inline">\(i = 1, \ldots, m\)</span>
</li>
<li><span class="math inline">\(\mu_i \sim N(\mu_0^{(\mu)}, \sigma_0^{(\mu)}) \quad \forall i = 1, \ldots, m\)</span></li>
<li><span class="math inline">\(\sigma_i \sim N(\mu_0^{(\sigma)}, \sigma_0^{(\sigma)}) \quad \forall i = 1, \ldots, m\)</span></li>
</ul>
<p>We assume that <span class="math inline">\(\mu_0^{(\mu)}, \sigma_0^{(\mu)}, \mu_0^{(\sigma)}, \sigma_0^{(\sigma)}\)</span> are known.</p>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>The Normal-Normal model is implemented in <code>rsamplestudy</code>.<br>
Let’s generate some data:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt; Attaching package: 'dplyr'</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; The following objects are masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt;     filter, lag</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt; The following objects are masked from 'package:base':</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt;     intersect, setdiff, setequal, union</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(rsamplestudy)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">n &lt;-<span class="st"> </span><span class="dv">200</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">m &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">list_pop &lt;-<span class="st"> </span>rsamplestudy<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rsamplestudy/topics/fun_rnorm_population">fun_rnorm_population</a></span>(n, m)</a>
<a class="sourceLine" id="cb1-16" data-line-number="16"></a>
<a class="sourceLine" id="cb1-17" data-line-number="17">list_pop<span class="op">$</span>df_pop <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> x, <span class="dt">y =</span> source, <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(source)), <span class="dt">position =</span> <span class="st">'jitter'</span>)</a></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">list_pop<span class="op">$</span>df_sources</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; # A tibble: 5 x 3</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt;   source    mu sigma</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt;    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; 1      1  1.13 0.209</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; 2      2  1.15 0.547</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt; 3      3  3.18 0.426</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; 4      4  2.15 0.246</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt; 5      5  2.47 0.561</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"></a>
<a class="sourceLine" id="cb2-13" data-line-number="13">list_pop<span class="op">$</span>list_hyper</a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt; $m_mu</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt; [1] 2.287247</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt; $m_sigma</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt; [1] 1.196772</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co">#&gt; $s_mu</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">#&gt; [1] -0.6942925</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="co">#&gt; $s_sigma</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="co">#&gt; [1] 0.412293</span></a></code></pre></div>
<p>Generate two sets of samples, under two different hypotheses:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">k_ref &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">k_quest &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">source_ref &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">source_same &lt;-<span class="st"> </span>source_ref</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">source_diff &lt;-<span class="st"> </span><span class="dv">3</span>             <span class="co"># single questioned different source</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">list_samples_same &lt;-<span class="st"> </span>rsamplestudy<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rsamplestudy/topics/make_dataset_splits">make_dataset_splits</a></span>(list_pop<span class="op">$</span>df_pop, k_ref, k_quest, <span class="dt">source_ref =</span> source_ref, <span class="dt">source_quest =</span> source_same)</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">list_samples_diff &lt;-<span class="st"> </span>rsamplestudy<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rsamplestudy/topics/make_dataset_splits">make_dataset_splits</a></span>(list_pop<span class="op">$</span>df_pop, k_ref, k_quest, <span class="dt">source_ref =</span> source_ref, <span class="dt">source_quest =</span> source_diff)</a></code></pre></div>
<p>Organize data, and elicit the hyperprior from the background data (assume vague hyperpriors):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">list_data_same &lt;-<span class="st"> </span>rstanBF<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rstanBF/topics/stanBF_prepare_rsamplestudy_data">stanBF_prepare_rsamplestudy_data</a></span>(list_pop, list_samples_same)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">list_data_diff &lt;-<span class="st"> </span>rstanBF<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rstanBF/topics/stanBF_prepare_rsamplestudy_data">stanBF_prepare_rsamplestudy_data</a></span>(list_pop, list_samples_diff)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">list_hyper &lt;-<span class="st"> </span>rstanBF<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rstanBF/topics/stanBF_elicit_hyperpriors">stanBF_elicit_hyperpriors</a></span>(list_samples_same<span class="op">$</span>df_background, <span class="st">'NormNorm'</span>, <span class="st">'vague'</span>)</a></code></pre></div>
<p>Perform the NUTS sampling:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">n.iter &lt;-<span class="st"> </span><span class="dv">5000</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">n.burnin &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">n.cores &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">n.chains &lt;-<span class="st"> </span>n.cores</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">obj_StanBF_same &lt;-<span class="st"> </span>rstanBF<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rstanBF/topics/compute_BF_Stan">compute_BF_Stan</a></span>(list_data_same, <span class="st">'NormNorm'</span>, list_hyper, <span class="dt">n.iter =</span> n.iter, <span class="dt">n.burnin =</span> n.burnin, <span class="dt">n.cores =</span> n.cores, <span class="dt">n.chains =</span> n.chains, <span class="dt">silent =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">obj_StanBF_diff &lt;-<span class="st"> </span>rstanBF<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rstanBF/topics/compute_BF_Stan">compute_BF_Stan</a></span>(list_data_diff, <span class="st">'NormNorm'</span>, list_hyper, <span class="dt">n.iter =</span> n.iter, <span class="dt">n.burnin =</span> n.burnin, <span class="dt">n.cores =</span> n.cores, <span class="dt">n.chains =</span> n.chains, <span class="dt">silent =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">obj_StanBF_same</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; stanBF object containing posterior samples from H1, H2.</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; Model: Normal-Normal </span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; Obtained BF: 1733724 </span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; Ran with 3 chains, 5000 HMC iterations.</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">obj_StanBF_diff</a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; stanBF object containing posterior samples from H1, H2.</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; Model: Normal-Normal </span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt; Obtained BF: 1.0192e-05 </span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt; Ran with 3 chains, 5000 HMC iterations.</span></a></code></pre></div>
<p>More details on the Stan outputs:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">obj_StanBF_same<span class="op">$</span>stanfit</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; $H1</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; Inference for Stan model: stan_NormNorm_H1.</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; 3 chains, each with iter=5000; warmup=1000; thin=1; </span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt; post-warmup draws per chain=4000, total post-warmup draws=12000.</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;                 mean se_mean     sd    2.5%    25%    50%    75%  97.5%</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt; mu_ref          1.05    0.00   0.05    0.95   1.02   1.05   1.08   1.15</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt; sigma_ref       0.22    0.00   0.04    0.16   0.19   0.21   0.24   0.31</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt; sim_mu_ref      0.06    0.91 100.01 -199.28 -67.42  -1.19  67.71 198.64</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt; sim_sigma_ref  79.68    0.56  60.58    3.36  31.64  66.99 115.32 224.85</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt; sim_d_ref       0.67    1.29 140.73 -276.69 -85.78  -0.61  86.74 284.32</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt; pred_d_ref      1.05    0.00   0.23    0.60   0.90   1.05   1.20   1.50</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt; lp__          -10.47    0.02   1.06  -13.25 -10.86 -10.14  -9.72  -9.44</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt;               n_eff Rhat</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt; mu_ref         7981    1</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#&gt; sigma_ref      7142    1</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co">#&gt; sim_mu_ref    11950    1</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="co">#&gt; sim_sigma_ref 11679    1</span></a>
<a class="sourceLine" id="cb7-20" data-line-number="20"><span class="co">#&gt; sim_d_ref     11824    1</span></a>
<a class="sourceLine" id="cb7-21" data-line-number="21"><span class="co">#&gt; pred_d_ref    12055    1</span></a>
<a class="sourceLine" id="cb7-22" data-line-number="22"><span class="co">#&gt; lp__           4643    1</span></a>
<a class="sourceLine" id="cb7-23" data-line-number="23"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-24" data-line-number="24"><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Tue Jan 29 18:19:23 2019.</span></a>
<a class="sourceLine" id="cb7-25" data-line-number="25"><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></a>
<a class="sourceLine" id="cb7-26" data-line-number="26"><span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></a>
<a class="sourceLine" id="cb7-27" data-line-number="27"><span class="co">#&gt; convergence, Rhat=1).</span></a>
<a class="sourceLine" id="cb7-28" data-line-number="28"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-29" data-line-number="29"><span class="co">#&gt; $H2</span></a>
<a class="sourceLine" id="cb7-30" data-line-number="30"><span class="co">#&gt; Inference for Stan model: stan_NormNorm_H2.</span></a>
<a class="sourceLine" id="cb7-31" data-line-number="31"><span class="co">#&gt; 3 chains, each with iter=5000; warmup=1000; thin=1; </span></a>
<a class="sourceLine" id="cb7-32" data-line-number="32"><span class="co">#&gt; post-warmup draws per chain=4000, total post-warmup draws=12000.</span></a>
<a class="sourceLine" id="cb7-33" data-line-number="33"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-34" data-line-number="34"><span class="co">#&gt;                   mean se_mean     sd    2.5%    25%    50%    75%  97.5%</span></a>
<a class="sourceLine" id="cb7-35" data-line-number="35"><span class="co">#&gt; mu_ref            1.06    0.00   0.09    0.88   1.00   1.06   1.11   1.24</span></a>
<a class="sourceLine" id="cb7-36" data-line-number="36"><span class="co">#&gt; sigma_ref         0.28    0.00   0.08    0.17   0.22   0.26   0.31   0.47</span></a>
<a class="sourceLine" id="cb7-37" data-line-number="37"><span class="co">#&gt; mu_quest          1.04    0.00   0.07    0.91   1.00   1.04   1.08   1.18</span></a>
<a class="sourceLine" id="cb7-38" data-line-number="38"><span class="co">#&gt; sigma_quest       0.21    0.00   0.06    0.13   0.16   0.19   0.23   0.36</span></a>
<a class="sourceLine" id="cb7-39" data-line-number="39"><span class="co">#&gt; sim_mu_ref        1.26    0.91 100.00 -194.53 -66.39   1.47  68.02 193.23</span></a>
<a class="sourceLine" id="cb7-40" data-line-number="40"><span class="co">#&gt; sim_sigma_ref    79.81    0.55  60.44    3.14  32.21  67.01 114.61 224.73</span></a>
<a class="sourceLine" id="cb7-41" data-line-number="41"><span class="co">#&gt; sim_mu_quest      1.73    0.92 100.05 -191.88 -65.67   1.18  69.17 195.88</span></a>
<a class="sourceLine" id="cb7-42" data-line-number="42"><span class="co">#&gt; sim_sigma_quest  79.51    0.55  60.54    2.82  31.18  66.78 114.33 223.35</span></a>
<a class="sourceLine" id="cb7-43" data-line-number="43"><span class="co">#&gt; sim_d_ref         1.45    1.29 142.38 -284.24 -83.91   2.56  87.33 284.81</span></a>
<a class="sourceLine" id="cb7-44" data-line-number="44"><span class="co">#&gt; sim_d_quest       1.36    1.29 140.58 -277.61 -84.74  -0.92  88.23 284.23</span></a>
<a class="sourceLine" id="cb7-45" data-line-number="45"><span class="co">#&gt; pred_d_ref        1.06    0.00   0.30    0.47   0.87   1.06   1.24   1.65</span></a>
<a class="sourceLine" id="cb7-46" data-line-number="46"><span class="co">#&gt; pred_d_quest      1.04    0.00   0.23    0.59   0.90   1.04   1.18   1.48</span></a>
<a class="sourceLine" id="cb7-47" data-line-number="47"><span class="co">#&gt; lp__            -24.48    0.02   1.53  -28.35 -25.21 -24.14 -23.37 -22.59</span></a>
<a class="sourceLine" id="cb7-48" data-line-number="48"><span class="co">#&gt;                 n_eff Rhat</span></a>
<a class="sourceLine" id="cb7-49" data-line-number="49"><span class="co">#&gt; mu_ref           9152    1</span></a>
<a class="sourceLine" id="cb7-50" data-line-number="50"><span class="co">#&gt; sigma_ref        7868    1</span></a>
<a class="sourceLine" id="cb7-51" data-line-number="51"><span class="co">#&gt; mu_quest         7179    1</span></a>
<a class="sourceLine" id="cb7-52" data-line-number="52"><span class="co">#&gt; sigma_quest      7048    1</span></a>
<a class="sourceLine" id="cb7-53" data-line-number="53"><span class="co">#&gt; sim_mu_ref      12034    1</span></a>
<a class="sourceLine" id="cb7-54" data-line-number="54"><span class="co">#&gt; sim_sigma_ref   12096    1</span></a>
<a class="sourceLine" id="cb7-55" data-line-number="55"><span class="co">#&gt; sim_mu_quest    11823    1</span></a>
<a class="sourceLine" id="cb7-56" data-line-number="56"><span class="co">#&gt; sim_sigma_quest 12086    1</span></a>
<a class="sourceLine" id="cb7-57" data-line-number="57"><span class="co">#&gt; sim_d_ref       12193    1</span></a>
<a class="sourceLine" id="cb7-58" data-line-number="58"><span class="co">#&gt; sim_d_quest     11952    1</span></a>
<a class="sourceLine" id="cb7-59" data-line-number="59"><span class="co">#&gt; pred_d_ref      11313    1</span></a>
<a class="sourceLine" id="cb7-60" data-line-number="60"><span class="co">#&gt; pred_d_quest    11339    1</span></a>
<a class="sourceLine" id="cb7-61" data-line-number="61"><span class="co">#&gt; lp__             4502    1</span></a>
<a class="sourceLine" id="cb7-62" data-line-number="62"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-63" data-line-number="63"><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Tue Jan 29 18:19:24 2019.</span></a>
<a class="sourceLine" id="cb7-64" data-line-number="64"><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></a>
<a class="sourceLine" id="cb7-65" data-line-number="65"><span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></a>
<a class="sourceLine" id="cb7-66" data-line-number="66"><span class="co">#&gt; convergence, Rhat=1).</span></a>
<a class="sourceLine" id="cb7-67" data-line-number="67"></a>
<a class="sourceLine" id="cb7-68" data-line-number="68">obj_StanBF_diff<span class="op">$</span>stanfit</a>
<a class="sourceLine" id="cb7-69" data-line-number="69"><span class="co">#&gt; $H1</span></a>
<a class="sourceLine" id="cb7-70" data-line-number="70"><span class="co">#&gt; Inference for Stan model: stan_NormNorm_H1.</span></a>
<a class="sourceLine" id="cb7-71" data-line-number="71"><span class="co">#&gt; 3 chains, each with iter=5000; warmup=1000; thin=1; </span></a>
<a class="sourceLine" id="cb7-72" data-line-number="72"><span class="co">#&gt; post-warmup draws per chain=4000, total post-warmup draws=12000.</span></a>
<a class="sourceLine" id="cb7-73" data-line-number="73"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-74" data-line-number="74"><span class="co">#&gt;                 mean se_mean     sd    2.5%    25%    50%    75%  97.5%</span></a>
<a class="sourceLine" id="cb7-75" data-line-number="75"><span class="co">#&gt; mu_ref          2.09    0.00   0.28    1.54   1.91   2.10   2.28   2.64</span></a>
<a class="sourceLine" id="cb7-76" data-line-number="76"><span class="co">#&gt; sigma_ref       1.25    0.00   0.23    0.90   1.09   1.22   1.38   1.78</span></a>
<a class="sourceLine" id="cb7-77" data-line-number="77"><span class="co">#&gt; sim_mu_ref      0.14    0.91  99.26 -196.86 -66.38   0.73  66.82 196.57</span></a>
<a class="sourceLine" id="cb7-78" data-line-number="78"><span class="co">#&gt; sim_sigma_ref  79.33    0.55  60.19    3.09  31.61  66.62 113.99 224.08</span></a>
<a class="sourceLine" id="cb7-79" data-line-number="79"><span class="co">#&gt; sim_d_ref       0.71    1.27 139.00 -274.74 -85.29   2.30  84.56 275.07</span></a>
<a class="sourceLine" id="cb7-80" data-line-number="80"><span class="co">#&gt; pred_d_ref      2.11    0.01   1.31   -0.49   1.26   2.10   2.96   4.70</span></a>
<a class="sourceLine" id="cb7-81" data-line-number="81"><span class="co">#&gt; lp__          -43.51    0.02   1.04  -46.34 -43.91 -43.20 -42.77 -42.48</span></a>
<a class="sourceLine" id="cb7-82" data-line-number="82"><span class="co">#&gt;               n_eff Rhat</span></a>
<a class="sourceLine" id="cb7-83" data-line-number="83"><span class="co">#&gt; mu_ref         6663    1</span></a>
<a class="sourceLine" id="cb7-84" data-line-number="84"><span class="co">#&gt; sigma_ref      6700    1</span></a>
<a class="sourceLine" id="cb7-85" data-line-number="85"><span class="co">#&gt; sim_mu_ref    11881    1</span></a>
<a class="sourceLine" id="cb7-86" data-line-number="86"><span class="co">#&gt; sim_sigma_ref 11770    1</span></a>
<a class="sourceLine" id="cb7-87" data-line-number="87"><span class="co">#&gt; sim_d_ref     11919    1</span></a>
<a class="sourceLine" id="cb7-88" data-line-number="88"><span class="co">#&gt; pred_d_ref    11005    1</span></a>
<a class="sourceLine" id="cb7-89" data-line-number="89"><span class="co">#&gt; lp__           4794    1</span></a>
<a class="sourceLine" id="cb7-90" data-line-number="90"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-91" data-line-number="91"><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Tue Jan 29 18:19:31 2019.</span></a>
<a class="sourceLine" id="cb7-92" data-line-number="92"><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></a>
<a class="sourceLine" id="cb7-93" data-line-number="93"><span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></a>
<a class="sourceLine" id="cb7-94" data-line-number="94"><span class="co">#&gt; convergence, Rhat=1).</span></a>
<a class="sourceLine" id="cb7-95" data-line-number="95"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-96" data-line-number="96"><span class="co">#&gt; $H2</span></a>
<a class="sourceLine" id="cb7-97" data-line-number="97"><span class="co">#&gt; Inference for Stan model: stan_NormNorm_H2.</span></a>
<a class="sourceLine" id="cb7-98" data-line-number="98"><span class="co">#&gt; 3 chains, each with iter=5000; warmup=1000; thin=1; </span></a>
<a class="sourceLine" id="cb7-99" data-line-number="99"><span class="co">#&gt; post-warmup draws per chain=4000, total post-warmup draws=12000.</span></a>
<a class="sourceLine" id="cb7-100" data-line-number="100"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-101" data-line-number="101"><span class="co">#&gt;                   mean se_mean     sd    2.5%    25%    50%    75%  97.5%</span></a>
<a class="sourceLine" id="cb7-102" data-line-number="102"><span class="co">#&gt; mu_ref            1.01    0.00   0.07    0.88   0.97   1.01   1.05   1.14</span></a>
<a class="sourceLine" id="cb7-103" data-line-number="103"><span class="co">#&gt; sigma_ref         0.20    0.00   0.06    0.12   0.16   0.19   0.23   0.35</span></a>
<a class="sourceLine" id="cb7-104" data-line-number="104"><span class="co">#&gt; mu_quest          3.17    0.00   0.19    2.80   3.06   3.17   3.28   3.54</span></a>
<a class="sourceLine" id="cb7-105" data-line-number="105"><span class="co">#&gt; sigma_quest       0.56    0.00   0.16    0.34   0.45   0.53   0.64   0.97</span></a>
<a class="sourceLine" id="cb7-106" data-line-number="106"><span class="co">#&gt; sim_mu_ref        0.81    0.92  99.60 -195.10 -66.48  -0.47  68.75 196.93</span></a>
<a class="sourceLine" id="cb7-107" data-line-number="107"><span class="co">#&gt; sim_sigma_ref    79.96    0.56  60.36    3.00  31.60  67.74 115.45 222.76</span></a>
<a class="sourceLine" id="cb7-108" data-line-number="108"><span class="co">#&gt; sim_mu_quest      0.06    0.91 100.72 -197.76 -67.81  -0.30  67.16 198.19</span></a>
<a class="sourceLine" id="cb7-109" data-line-number="109"><span class="co">#&gt; sim_sigma_quest  78.76    0.54  59.70    2.94  31.33  66.08 113.83 223.54</span></a>
<a class="sourceLine" id="cb7-110" data-line-number="110"><span class="co">#&gt; sim_d_ref         0.27    1.30 141.90 -283.28 -86.05   1.53  86.81 288.95</span></a>
<a class="sourceLine" id="cb7-111" data-line-number="111"><span class="co">#&gt; sim_d_quest      -1.82    1.28 140.33 -283.24 -88.09  -0.57  84.02 275.81</span></a>
<a class="sourceLine" id="cb7-112" data-line-number="112"><span class="co">#&gt; pred_d_ref        1.01    0.00   0.23    0.56   0.88   1.01   1.14   1.46</span></a>
<a class="sourceLine" id="cb7-113" data-line-number="113"><span class="co">#&gt; pred_d_quest      3.17    0.01   0.61    1.91   2.80   3.17   3.54   4.39</span></a>
<a class="sourceLine" id="cb7-114" data-line-number="114"><span class="co">#&gt; lp__            -30.65    0.02   1.57  -34.59 -31.41 -30.29 -29.51 -28.73</span></a>
<a class="sourceLine" id="cb7-115" data-line-number="115"><span class="co">#&gt;                 n_eff Rhat</span></a>
<a class="sourceLine" id="cb7-116" data-line-number="116"><span class="co">#&gt; mu_ref           8251    1</span></a>
<a class="sourceLine" id="cb7-117" data-line-number="117"><span class="co">#&gt; sigma_ref        7308    1</span></a>
<a class="sourceLine" id="cb7-118" data-line-number="118"><span class="co">#&gt; mu_quest         7855    1</span></a>
<a class="sourceLine" id="cb7-119" data-line-number="119"><span class="co">#&gt; sigma_quest      7818    1</span></a>
<a class="sourceLine" id="cb7-120" data-line-number="120"><span class="co">#&gt; sim_mu_ref      11812    1</span></a>
<a class="sourceLine" id="cb7-121" data-line-number="121"><span class="co">#&gt; sim_sigma_ref   11665    1</span></a>
<a class="sourceLine" id="cb7-122" data-line-number="122"><span class="co">#&gt; sim_mu_quest    12276    1</span></a>
<a class="sourceLine" id="cb7-123" data-line-number="123"><span class="co">#&gt; sim_sigma_quest 12022    1</span></a>
<a class="sourceLine" id="cb7-124" data-line-number="124"><span class="co">#&gt; sim_d_ref       11906    1</span></a>
<a class="sourceLine" id="cb7-125" data-line-number="125"><span class="co">#&gt; sim_d_quest     12050    1</span></a>
<a class="sourceLine" id="cb7-126" data-line-number="126"><span class="co">#&gt; pred_d_ref      11162    1</span></a>
<a class="sourceLine" id="cb7-127" data-line-number="127"><span class="co">#&gt; pred_d_quest    11652    1</span></a>
<a class="sourceLine" id="cb7-128" data-line-number="128"><span class="co">#&gt; lp__             4579    1</span></a>
<a class="sourceLine" id="cb7-129" data-line-number="129"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-130" data-line-number="130"><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Tue Jan 29 18:19:32 2019.</span></a>
<a class="sourceLine" id="cb7-131" data-line-number="131"><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></a>
<a class="sourceLine" id="cb7-132" data-line-number="132"><span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></a>
<a class="sourceLine" id="cb7-133" data-line-number="133"><span class="co">#&gt; convergence, Rhat=1).</span></a></code></pre></div>
</div>
<div id="post-processing" class="section level2">
<h2 class="hasAnchor">
<a href="#post-processing" class="anchor"></a>Post-processing</h2>
<p>Using general post-processing utils in <code>bayesplot</code> package:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/message">suppressPackageStartupMessages</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(rstan))</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(bayesplot)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; This is bayesplot version 1.6.0</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; - Online documentation and vignettes at mc-stan.org/bayesplot</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; - bayesplot theme set to bayesplot::theme_default()</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt;    * Does _not_ affect other ggplot2 plots</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt;    * See ?bayesplot_theme_set for details on theme setting</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"></a>
<a class="sourceLine" id="cb8-9" data-line-number="9">results_same_H1 &lt;-<span class="st"> </span>obj_StanBF_same<span class="op">$</span>stanfit<span class="op">$</span>H1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rstan/topics/As.mcmc.list">As.mcmc.list</a></span>()</a>
<a class="sourceLine" id="cb8-10" data-line-number="10">results_same_H2 &lt;-<span class="st"> </span>obj_StanBF_same<span class="op">$</span>stanfit<span class="op">$</span>H2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rstan/topics/As.mcmc.list">As.mcmc.list</a></span>()</a></code></pre></div>
<div id="parameter-recovery" class="section level3">
<h3 class="hasAnchor">
<a href="#parameter-recovery" class="anchor"></a>Parameter recovery</h3>
<p>First, we recover NUTS draws and true values. Then we use <code>bayesplot</code> tools to plot them.<br>
Notice that the orders of the variables in <code>mcmc_recover_intervals</code> arguments must match.</p>
<p>Questioned data sampled under <span class="math inline">\(H_1\)</span>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co"># H1</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">draws &lt;-<span class="st"> </span>obj_StanBF_same<span class="op">$</span>stanfit<span class="op">$</span>H1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rstan/topics/As.mcmc.list">As.mcmc.list</a></span>(<span class="dt">pars =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'mu_ref'</span>, <span class="st">'sigma_ref'</span>))</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">df_sources_ref &lt;-<span class="st"> </span>list_pop<span class="op">$</span>df_sources <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(source <span class="op">==</span><span class="st"> </span>source_same) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(mu, sigma)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">true_sources &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(df_sources_ref)</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">bayesplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/bayesplot/topics/MCMC-recover">mcmc_recover_intervals</a></span>(draws, true_sources)</a></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/par-recovery-H1-1.png" width="672"></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co"># H2, reference and questioned</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3">draws &lt;-<span class="st"> </span>obj_StanBF_same<span class="op">$</span>stanfit<span class="op">$</span>H2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rstan/topics/As.mcmc.list">As.mcmc.list</a></span>(<span class="dt">pars =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'mu_ref'</span>, <span class="st">'sigma_ref'</span>, <span class="st">'mu_quest'</span>, <span class="st">'sigma_quest'</span>))</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">df_sources &lt;-<span class="st"> </span>list_pop<span class="op">$</span>df_sources <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(source <span class="op">==</span><span class="st"> </span>source_same) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(mu, sigma)</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">true_sources &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(df_sources), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"></a>
<a class="sourceLine" id="cb10-7" data-line-number="7">bayesplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/bayesplot/topics/MCMC-recover">mcmc_recover_intervals</a></span>(draws, true_sources)</a></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/par-recovery-H1-2.png" width="672"></p>
<p>Questioned data sampled under <span class="math inline">\(H_2\)</span>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co"># H1: assuming that sources are the same</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co"># This is not true, so the posteriors do not fit well</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">draws &lt;-<span class="st"> </span>obj_StanBF_diff<span class="op">$</span>stanfit<span class="op">$</span>H1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rstan/topics/As.mcmc.list">As.mcmc.list</a></span>(<span class="dt">pars =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'mu_ref'</span>, <span class="st">'sigma_ref'</span>))</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">df_sources_ref &lt;-<span class="st"> </span>list_pop<span class="op">$</span>df_sources <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(source <span class="op">==</span><span class="st"> </span>source_same) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(mu, sigma)</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">true_sources &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(df_sources_ref)</a>
<a class="sourceLine" id="cb11-8" data-line-number="8"></a>
<a class="sourceLine" id="cb11-9" data-line-number="9">bayesplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/bayesplot/topics/MCMC-recover">mcmc_recover_intervals</a></span>(draws, true_sources)</a></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/par-recovery-H2-1.png" width="672"></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co"># H2, reference and questioned from different sources</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co"># This is true, the posteriors are also good</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">draws &lt;-<span class="st"> </span>obj_StanBF_diff<span class="op">$</span>stanfit<span class="op">$</span>H2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rstan/topics/As.mcmc.list">As.mcmc.list</a></span>(<span class="dt">pars =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'mu_ref'</span>, <span class="st">'sigma_ref'</span>, <span class="st">'mu_quest'</span>, <span class="st">'sigma_quest'</span>))</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">df_sources_ref &lt;-<span class="st"> </span>list_pop<span class="op">$</span>df_sources <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(source <span class="op">==</span><span class="st"> </span>source_same) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(mu, sigma)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">df_sources_quest &lt;-<span class="st"> </span>list_pop<span class="op">$</span>df_sources <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(source <span class="op">==</span><span class="st"> </span>source_diff) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(mu, sigma)</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">true_sources &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(df_sources_ref), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(df_sources_quest))</a>
<a class="sourceLine" id="cb12-8" data-line-number="8"></a>
<a class="sourceLine" id="cb12-9" data-line-number="9">bayesplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/bayesplot/topics/MCMC-recover">mcmc_recover_intervals</a></span>(draws, true_sources)</a></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/par-recovery-H2-2.png" width="672"></p>
</div>
<div id="prior-and-posterior-predictive-checks" class="section level3">
<h3 class="hasAnchor">
<a href="#prior-and-posterior-predictive-checks" class="anchor"></a>Prior and posterior predictive checks</h3>
<p>To simplify, consider only when data is sampled from the same source.</p>
<p>Here, we plot the <strong>prior</strong> predictive distribution.<br>
It should generate data which should be realistic, but not necessarily adapted to the observed data.<br>
It represents the background knowledge of our data.</p>
<p>Here, we specified a very vague prior, so the generated values are really extreme compared to the one measured.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="co"># H1: prior predictive</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3">draws_prior &lt;-<span class="st"> </span>obj_StanBF_same<span class="op">$</span>stanfit<span class="op">$</span>H1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(<span class="dt">pars =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'sim_d_ref'</span>))</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">data_ref &lt;-<span class="st"> </span>list_pop<span class="op">$</span>df_pop <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(source <span class="op">==</span><span class="st"> </span>source_ref) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(<span class="st">'x'</span>)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5"></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co"># extract a subset of draws</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7">draws_prior_sub &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(draws_prior[<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(data_ref)]))</a>
<a class="sourceLine" id="cb13-8" data-line-number="8">bayesplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/bayesplot/topics/PPC-distributions">ppc_dens_overlay</a></span>(data_ref, draws_prior_sub) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="dt">limits =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co">#&gt; Warning: Removed 184 rows containing non-finite values (stat_density).</span></a></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/prior-check-1.png" width="672"></p>
<p>The posterior predictive distribution, instead, should be a good approximation of the observed data.</p>
<p>If it does not occur, it means that the model is not capable of predicting from the correct distribution.<br>
In other words, the trained model is not adapted to the observed data.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">draws_posterior &lt;-<span class="st"> </span>obj_StanBF_same<span class="op">$</span>stanfit<span class="op">$</span>H1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(<span class="dt">pars =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'pred_d_ref'</span>))</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">draws_posterior_sub &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(draws_posterior[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(draws_posterior) <span class="op">-</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(data_ref)) ]))</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">bayesplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/bayesplot/topics/PPC-distributions">ppc_dens_overlay</a></span>(data_ref, draws_posterior_sub)</a></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/posterior-check-H1-1.png" width="672"></p>
<p>To check that it is working, let’s consider the situation where the sources are different, and consider the reference and questioned items separately.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">data_quest &lt;-<span class="st"> </span>list_pop<span class="op">$</span>df_pop <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(source <span class="op">==</span><span class="st"> </span>source_diff) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(<span class="st">'x'</span>)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="co"># Reference data</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">draws_posterior &lt;-<span class="st"> </span>obj_StanBF_diff<span class="op">$</span>stanfit<span class="op">$</span>H2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(<span class="dt">pars =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'pred_d_ref'</span>))</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">draws_posterior_sub &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(draws_posterior[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(draws_posterior) <span class="op">-</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(data_ref)) ]))</a>
<a class="sourceLine" id="cb15-6" data-line-number="6"></a>
<a class="sourceLine" id="cb15-7" data-line-number="7">bayesplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/bayesplot/topics/PPC-distributions">ppc_dens_overlay</a></span>(data_ref, draws_posterior_sub)</a></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/posterior-check-H2-1.png" width="672"></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="co"># Questioned data</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3">draws_posterior &lt;-<span class="st"> </span>obj_StanBF_diff<span class="op">$</span>stanfit<span class="op">$</span>H2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(<span class="dt">pars =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'pred_d_quest'</span>))</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">draws_posterior_sub &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(draws_posterior[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(draws_posterior) <span class="op">-</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(data_quest)) ]))</a>
<a class="sourceLine" id="cb16-5" data-line-number="5"></a>
<a class="sourceLine" id="cb16-6" data-line-number="6">bayesplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/bayesplot/topics/PPC-distributions">ppc_dens_overlay</a></span>(data_ref, draws_posterior_sub) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">'Predicting reference samples with the questioned data'</span>)</a></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/posterior-check-H2-2.png" width="672"></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">bayesplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/bayesplot/topics/PPC-distributions">ppc_dens_overlay</a></span>(data_quest, draws_posterior_sub) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">'Predicting questioned samples with the questioned data'</span>)</a></code></pre></div>
<p><img src="normalnormal-model_files/figure-html/posterior-check-H2-3.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#model">Model</a></li>
      <li><a href="#data">Data</a></li>
      <li><a href="#post-processing">Post-processing</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Lorenzo Gaborini.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
